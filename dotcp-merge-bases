#!/bin/sh

# Merge all base branches into master. Use this to distribute changes made on
# one machine to all others.
#
# usage
#
# $ ./this.sh [git merge opts]

set -eu

master_branch=master

# Octopus merge: merge multiple branches into one.
#
#   $ git co master
#   $ git merge base-foo base-bar base-baz
#
# This will only move master to the most recent base-foo. All other base-*
# which are now older than master are not moved and must be moved by separate
#
#   $ git co base-bar
#   $ git merge master
#   $ git co base-baz
#   $ git merge master
#
base_branches=$(git branch --format='%(refname:short)' | grep 'base-')
echo $base_branches

git checkout $master_branch
git merge $base_branches

for base_branch in $base_branches; do
    git checkout $base_branch
    git merge $@ $master_branch
done
